@layer components {
  /* ============================================
   * SOFTWARE CARD - Clean design with hover overlay
   * Uses overlay approach to avoid grid reflow issues
   * ============================================ */

  @scope (.software-card) {
    :scope {
      position: relative;
      aspect-ratio: 1;
      cursor: pointer;
      border-radius: var(--radius-md, 8px);
      transition:
        box-shadow 0.15s ease,
        border-color 0.15s ease;

      /* Base card */
      background: linear-gradient(
        135deg,
        oklch(0.14 0.02 250) 0%,
        oklch(0.10 0.015 250) 100%
      );
      border: 1px solid oklch(0.25 0.03 250);
      box-shadow: 0 2px 8px var(--black-20);

      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--space-md);
      text-align: center;
      gap: var(--space-xs);

      /* ===== HOVER STATE (JS-controlled via .hovered class) ===== */
      &.hovered {
        border-color: var(--accent);
        box-shadow:
          0 0 0 1px var(--accent-40),
          0 4px 16px var(--black-30);
        z-index: 20;

        /* Show the overlay panel */
        & .card-overlay {
          opacity: 1;
          visibility: visible;
          transform: scale(1);
          pointer-events: auto;
        }
      }

      /* Focus shows border highlight only, not overlay */
      &:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow:
          0 0 0 2px var(--accent),
          0 4px 16px var(--black-30);
      }

      &:focus-visible {
        outline: none;
        box-shadow:
          0 0 0 2px var(--accent),
          0 0 0 4px var(--accent-25);
      }

      /* Hidden state for filtering */
      &.hidden {
        display: none;
      }

      /* ===== SELECTED STATE ===== */
      &.selected {
        border-color: var(--accent);
        box-shadow:
          0 0 0 1px var(--accent),
          0 0 12px var(--accent-25),
          0 4px 16px var(--black-25);

        /* Checkmark badge */
        &::after {
          content: "âœ“";
          position: absolute;
          top: -6px;
          right: -6px;
          width: 20px;
          height: 20px;
          background: var(--accent);
          color: oklch(0.1 0 0);
          font-size: 11px;
          font-weight: 800;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 50%;
          z-index: 25;
          box-shadow: 0 2px 6px var(--accent-40);
        }

        & .name {
          color: var(--accent);
        }
      }

      /* Hide list view elements by default */
      & .list-desc,
      & .list-category {
        display: none;
      }

      /* ===== LEFT-POSITIONED OVERLAY (near right edge) ===== */
      /* Flips layout: info on left, logo on right (covers original card) */
      &[data-overlay-position="left"] .card-overlay {
        inset: 0 0 auto auto; /* top right bottom left - anchored to right */
        transform-origin: top right;
        /* Flip grid columns: info (240px) left, logo (card width) right */
        grid-template-columns: 240px 1fr;
      }

      &[data-overlay-position="left"] .overlay-card {
        grid-column: 2;
        border-right: none;
        border-left: 1px solid oklch(0.25 0.03 250);
      }

      &[data-overlay-position="left"] .overlay-info {
        grid-column: 1;
        text-align: right;
      }

      &[data-overlay-position="left"] .overlay-desc {
        text-align: right;
      }

      /* Flip header: category left, title right */
      &[data-overlay-position="left"] .overlay-header {
        flex-direction: row-reverse;
      }
    }

    /* ===== LOGO ===== */
    .logo {
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;

      & img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        filter: brightness(0) invert(1);
        opacity: 0.9;
      }

      & svg {
        width: 100%;
        height: 100%;
        color: var(--text-secondary);
        opacity: 0.85;
      }

      & .emoji-icon {
        font-size: 28px;
        line-height: 1;
      }

      & .sprite-icon {
        width: 100%;
        height: 100%;
        fill: currentColor;
        color: var(--text-primary);
      }

      & .fallback-icon {
        color: oklch(0.5 0.1 220);
        opacity: 0.6;
      }
    }

    /* ===== NAME ===== */
    .name {
      font-family: var(--font-ui);
      font-size: var(--text-sm);
      font-weight: 600;
      color: var(--text-primary);
      line-height: 1.2;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    /* ===== EXPANDED CARD OVERLAY (appears on hover) ===== */
    /* Covers original card AND extends - one continuous element */
    .card-overlay {
      position: absolute;
      inset: 0 auto auto 0; /* top right bottom left - explicit reset */
      width: calc(100% + 240px); /* Card width + info panel */
      min-height: 100%;
      z-index: 100;

      background: linear-gradient(
        135deg,
        oklch(0.16 0.025 250) 0%,
        oklch(0.11 0.02 250) 100%
      );
      border: 1px solid var(--accent-40);
      border-radius: var(--radius-md, 8px);
      box-shadow:
        0 8px 32px var(--black-50),
        0 0 0 1px var(--accent-20);

      /* Internal grid layout - company card style */
      /* Logo column = card width (1fr), info column = 240px */
      display: grid;
      grid-template-columns: 1fr 240px;
      grid-template-rows: 1fr auto;
      gap: 0;

      /* Hidden by default */
      opacity: 0;
      visibility: hidden;
      transform: scale(0.95);
      transform-origin: top left;
      transition:
        opacity 0.15s ease,
        transform 0.15s ease,
        visibility 0s 0.15s;
      pointer-events: none;
    }

    /* Left side: logo + name (mimics original card) */
    .overlay-card {
      grid-row: 1;
      grid-column: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--space-md);
      gap: var(--space-xs);
      text-align: center;
      min-width: 100px;
      border-right: 1px solid oklch(0.25 0.03 250);

      & .overlay-logo {
        width: 44px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;

        & img {
          width: 100%;
          height: 100%;
          object-fit: contain;
          filter: brightness(0) invert(1);
          opacity: 0.9;
        }

        & svg {
          width: 100%;
          height: 100%;
          color: var(--text-primary);
        }

        & .emoji-icon {
          font-size: 28px;
          line-height: 1;
        }
      }

      & .overlay-name {
        font-family: var(--font-ui);
        font-size: var(--text-sm);
        font-weight: 600;
        color: var(--text-primary);
        line-height: 1.2;
      }
    }

    /* Right side: info content */
    .overlay-info {
      grid-row: 1;
      grid-column: 2;
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
      padding: var(--space-md);
      text-align: left;
    }

    .overlay-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: var(--space-sm);
    }

    .overlay-title {
      font-family: var(--font-ui);
      font-size: var(--text-base);
      font-weight: 700;
      color: var(--text-primary);
      line-height: 1.2;
      margin: 0;
    }

    .overlay-category {
      font-size: var(--text-2xs);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--accent);
      background: var(--accent-10, color-mix(in oklch, var(--accent) 10%, transparent));
      padding: 0.2rem 0.4rem;
      border-radius: var(--radius-sm, 4px);
      white-space: nowrap;
      flex-shrink: 0;
    }

    .overlay-desc {
      font-size: var(--text-sm);
      color: var(--text-secondary);
      line-height: 1.4;
      margin: 0;
    }

    /* Bottom row: winget + action button */
    .overlay-footer {
      grid-row: 2;
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-md);
      padding: var(--space-sm) var(--space-md);
      border-top: 1px solid oklch(0.25 0.03 250);
      background: oklch(0.10 0.015 250);
      border-radius: 0 0 var(--radius-md, 8px) var(--radius-md, 8px);
    }

    .overlay-winget {
      display: flex;
      align-items: center;
      gap: var(--space-xs);
      font-family: var(--font-mono);
      font-size: 0.65rem;
      color: var(--text-hint);
      min-width: 0;
      flex: 1;
    }

    .overlay-winget-label {
      color: var(--text-hint);
      flex-shrink: 0;
    }

    .overlay-winget-id {
      color: var(--text-secondary);
      background: oklch(0.08 0.01 250);
      padding: 0.2rem 0.4rem;
      border-radius: 3px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .overlay-action {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-xs);
      padding: 0.5rem 1rem;
      font-size: var(--text-xs);
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      border: none;
      border-radius: var(--radius-sm, 4px);
      cursor: pointer;
      transition: background 0.15s ease, transform 0.1s ease;
      flex-shrink: 0;

      &:hover {
        transform: translateY(-1px);
      }

      &:active {
        transform: translateY(0);
      }
    }

    .overlay-action--add {
      background: var(--accent);
      color: oklch(0.1 0 0);

      &:hover {
        background: oklch(0.75 0.18 85);
      }
    }

    .overlay-action--remove {
      background: oklch(0.25 0.05 250);
      color: var(--text-secondary);

      &:hover {
        background: oklch(0.35 0.1 15);
        color: var(--text-primary);
      }
    }

    .overlay-action-icon {
      width: 12px;
      height: 12px;
    }
  }

  /* ===== EMPTY STATE ===== */
  .empty-state {
    grid-column: 1 / -1;
    text-align: center;
    padding: 2rem;
    color: var(--text-dim);
  }

  /* ===== MOBILE - No overlay, tap to select ===== */
  @media (max-width: 768px) {
    .software-card {
      & .logo {
        width: 36px;
        height: 36px;
      }

      & .name {
        font-size: 0.75rem;
      }

      & .card-overlay {
        display: none;
      }
    }
  }

  @media (max-width: 480px) {
    .software-card {
      & .logo {
        width: 32px;
        height: 32px;
      }

      & .name {
        font-size: 0.7rem;
      }
    }
  }
}
