@layer components {
  @scope (.software-card) {
    :scope {
      position: relative;
      aspect-ratio: 1;
      border-radius: 18%;
      corner-shape: squircle;
      transition:
        box-shadow 0.15s ease,
        border-color 0.15s ease;
      background: linear-gradient(135deg,
          oklch(0.14 0.02 250) 0%,
          oklch(0.10 0.015 250) 100%);
      border: 2px solid oklch(0.25 0.03 250);
      box-shadow: 0 2px 8px var(--black-20);
      display: flex;
      flex-direction: column;

      &:has(input:focus-visible) {
        outline: none;
        box-shadow:
          0 0 0 2px var(--accent),
          0 0 0 4px var(--accent-25);
      }

      &.hovered {
        border-color: var(--accent);
        box-shadow:
          0 0 0 1px var(--accent-40),
          0 4px 16px var(--black-30);
        z-index: 50;

        &::after {
          display: none;
        }

        & .card-overlay {
          opacity: 1;
          visibility: visible;
          transform: scale(1);
          pointer-events: auto;

          & .overlay-logo {
            color: var(--text-primary);
            fill: var(--text-primary);
          }
        }
      }


      &.hidden {
        display: none;
      }

      &.selected {
        background: linear-gradient(135deg,
            oklch(0.15 0.04 292) 0%,
            oklch(0.11 0.03 292) 100%);
        border: 2px solid var(--accent);
        box-shadow:
          0 0 0 1px var(--accent-40),
          0 0 16px var(--accent-30),
          0 4px 16px var(--black-30);

        &::after {
          content: "✓";
          position: absolute;
          top: -6px;
          right: -6px;
          width: 20px;
          height: 20px;
          background: var(--accent);
          color: oklch(0.1 0 0);
          font-size: 11px;
          font-weight: 800;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 50%;
          z-index: 25;
          box-shadow: 0 2px 6px var(--accent-40);
        }

        & .name {
          color: var(--accent);
        }
      }

      & .list-desc,
      & .list-category {
        display: none;
      }

      &[data-overlay-position="left"] .card-overlay {
        inset: 0 0 auto auto;
        transform-origin: top right;
        grid-template-columns: 240px 1fr;
      }

      &[data-overlay-position="left"] .overlay-card {
        grid-column: 2;
        border-right: none;
        border-left: 1px solid oklch(0.3 0.04 292 / 0.5);
      }

      &[data-overlay-position="left"] .overlay-info {
        grid-column: 1;
        text-align: right;
      }

      &[data-overlay-position="left"] .overlay-desc {
        text-align: right;
      }

      &[data-overlay-position="left"] .overlay-header {
        flex-direction: row-reverse;
      }
    }

    .logo {
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;

      & img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        filter: brightness(0) invert(1);
        opacity: 0.9;
      }

      & svg {
        width: 100%;
        height: 100%;
        color: var(--text-secondary);
        opacity: 0.85;
      }

      & .emoji-icon {
        font-size: 28px;
        line-height: 1;
      }

      & .sprite-icon {
        width: 100%;
        height: 100%;
        fill: currentColor;
        color: var(--text-primary);
      }

      & .fallback-icon {
        color: oklch(0.5 0.1 220);
        opacity: 0.6;
      }
    }

    .name {
      font-family: var(--font-ui);
      font-size: var(--text-sm);
      font-weight: 600;
      color: var(--text-primary);
      line-height: 1.2;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .card-label {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--space-md);
      text-align: center;
      gap: var(--space-xs);
      cursor: pointer;
      flex: 1;
      width: 100%;
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    .card-overlay {
      position: absolute;
      inset: 0 auto auto 0;
      width: calc(100% + 240px);
      min-height: 100%;
      z-index: 100;
      background: oklch(0.09 0.015 250);
      border: 1px solid oklch(0.45 0.12 292);
      border-radius: var(--radius-md);
      corner-shape: squircle;
      box-shadow:
        0 4px 20px oklch(0 0 0 / 0.7),
        0 0 0 1px oklch(0.5 0.15 292 / 0.3);
      display: grid;
      grid-template-columns: 1fr 240px;
      grid-template-rows: 1fr auto;
      gap: 0;
      opacity: 0;
      visibility: hidden;
      transform: scale(0.95);
      transform-origin: top left;
      transition:
        opacity 0.15s ease,
        transform 0.15s ease,
        visibility 0s 0.15s;
      pointer-events: none;
    }

    :scope.selected .card-overlay {
      background: linear-gradient(135deg,
          oklch(0.18 0.08 292) 0%,
          oklch(0.12 0.06 292) 100%);
      border-color: oklch(0.55 0.18 292);
    }

    :scope.selected .card-overlay .overlay-footer {
      background: oklch(0.10 0.05 292);
      border-top-color: oklch(0.35 0.1 292);
    }

    :scope.selected .card-overlay::after {
      content: "✓";
      position: absolute;
      top: -10px;
      right: -10px;
      width: 24px;
      height: 24px;
      background: var(--accent);
      color: oklch(0.1 0 0);
      font-size: 13px;
      font-weight: 800;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      z-index: 110;
      box-shadow:
        0 2px 8px var(--accent-40),
        0 0 0 2px oklch(0.09 0.015 250);
    }

    :scope.selected[data-overlay-position="left"] .card-overlay::after {
      right: auto;
      left: -10px;
    }

    .overlay-card {
      grid-row: 1;
      grid-column: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--space-md);
      gap: var(--space-xs);
      text-align: center;
      min-width: 100px;
      border-right: 1px solid oklch(0.3 0.04 292 / 0.5);

      & .overlay-logo {
        width: 44px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;

        & img {
          width: 100%;
          height: 100%;
          object-fit: contain;
          filter: brightness(0) invert(1);
          opacity: 0.9;
        }

        & svg {
          width: 100%;
          height: 100%;
          color: var(--text-primary);
        }

        & .emoji-icon {
          font-size: 28px;
          line-height: 1;
        }
      }

      & .overlay-name {
        font-family: var(--font-ui);
        font-size: var(--text-sm);
        font-weight: 600;
        color: var(--text-primary);
        line-height: 1.2;
      }
    }

    .overlay-info {
      grid-row: 1;
      grid-column: 2;
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
      padding: var(--space-md);
      text-align: left;
    }

    .overlay-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: var(--space-sm);
    }

    .overlay-title {
      font-family: var(--font-ui);
      font-size: var(--text-base);
      font-weight: 700;
      color: var(--text-primary);
      line-height: 1.2;
      margin: 0;
    }

    .overlay-category {
      font-size: var(--text-2xs);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--accent);
      background: var(--accent-10, color-mix(in oklch, var(--accent) 10%, transparent));
      padding: 0.2rem 0.4rem;
      border-radius: var(--radius-sm, 4px);
      white-space: nowrap;
      flex-shrink: 0;
    }

    .overlay-desc {
      font-size: var(--text-sm);
      color: var(--text-secondary);
      line-height: 1.4;
      margin: 0;
    }

    .overlay-footer {
      grid-row: 2;
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-md);
      padding: var(--space-sm) var(--space-md);
      border-top: 1px solid oklch(0.35 0.06 292);
      background: oklch(0.07 0.01 250);
      border-radius: 0 0 var(--radius-md) var(--radius-md);
      corner-shape: squircle;
    }

    .overlay-winget {
      display: flex;
      align-items: center;
      gap: var(--space-xs);
      font-family: var(--font-mono);
      font-size: 0.65rem;
      color: var(--text-hint);
      min-width: 0;
      flex: 1;
    }

    .overlay-winget-label {
      color: var(--text-hint);
      flex-shrink: 0;
    }

    .overlay-winget-id {
      color: var(--text-secondary);
      background: oklch(0.08 0.01 250);
      padding: 0.2rem 0.4rem;
      border-radius: 3px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .overlay-action {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-xs);
      padding: 0.5rem 1rem;
      font-size: var(--text-xs);
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      border: none;
      border-radius: var(--radius-sm, 4px);
      cursor: pointer;
      transition: background 0.15s ease, transform 0.1s ease;
      flex-shrink: 0;

      &:hover {
        transform: translateY(-1px);
      }

      &:active {
        transform: translateY(0);
      }
    }

    .overlay-action--add {
      background: var(--accent);
      color: oklch(0.1 0 0);

      &:hover {
        background: oklch(0.75 0.18 85);
      }
    }

    .overlay-action--remove {
      background: oklch(0.25 0.05 250);
      color: var(--text-secondary);

      &:hover {
        background: oklch(0.35 0.1 15);
        color: var(--text-primary);
      }
    }

    .overlay-action-icon {
      width: 12px;
      height: 12px;
    }
  }

  .empty-state {
    grid-column: 1 / -1;
    text-align: center;
    padding: 2rem;
    color: var(--text-dim);
  }

  @media (max-width: 768px) {
    .software-card {
      & .logo {
        width: 36px;
        height: 36px;
      }

      & .name {
        font-size: 0.75rem;
      }

      & .card-overlay {
        display: none;
      }
    }
  }

  @media (max-width: 480px) {
    .software-card {
      & .logo {
        width: 32px;
        height: 32px;
      }

      & .name {
        font-size: 0.7rem;
      }
    }
  }
}